<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香港酒吧地圖</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        #map { height: 100%; width: 100%; }
        .leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .leaflet-popup-content { font-family: 'Inter', sans-serif; margin: 15px 20px 15px 15px; text-align: center; }
        .hotel-icon { filter: drop-shadow(0 1px 3px rgba(0,0,0,0.4)); }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen" style="font-family: 'Noto Sans TC', sans-serif;">

    <header class="bg-gray-800 shadow-lg z-20">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
            <h1 class="text-2xl font-bold text-center text-yellow-400">香港酒吧地圖 (您的專屬清單)</h1>
            <p class="text-center text-gray-400 mt-1">點擊店家以在地圖上查看位置</p>
        </div>
    </header>

    <main class="flex-grow flex flex-col md:flex-row overflow-hidden">
        <div class="w-full md:w-2/3 h-2/3 md:h-full flex flex-col">
            <div id="map-container" class="flex-grow">
                <div id="map" class="rounded-lg shadow-md"></div>
            </div>
            <div class="p-2 bg-gray-800 text-center text-xs text-gray-400">
                請注意：本地圖 (使用 OpenStreetMap 圖資) 與 Google Maps 的建築物位置可能存在輕微視覺偏移。<br>請以點擊後在 Google Maps 中顯示的位置為最終依據。
            </div>
        </div>

        <div id="bar-list" class="w-full md:w-1/3 p-4 bg-gray-800 overflow-y-auto h-1/3 md:h-full">
            <div class="space-y-3">
                <!-- 酒吧項目將由 JavaScript 動態生成 -->
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            const map = L.map('map').setView([22.2835, 114.154], 16);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // 最終高精度驗證後的酒吧清單
            const locations = [
                { name: 'AOAO', address: '中環皇后大道中38-48號 M88 16樓', coords: [22.28194, 114.15633] },
                { name: 'Bar Mind', address: '中環伊利近街11號', coords: [22.28171, 114.15422] },
                { name: 'The Savory Project', address: '中環伊利近街4號', coords: [22.28183, 114.15403] },
                { name: 'The Opposite', address: '中環士丹利街18號地下', coords: [22.28270, 114.15651] },
                { name: 'GOKAN', address: '中環擺花街13號', coords: [22.28220, 114.15495] },
                { name: 'Bar de Luxe', address: '中環砵甸乍街45號 H Code 2樓', coords: [22.28243, 114.15581] },
                { name: 'Quinary', address: '中環荷李活道56-58號', coords: [22.28293, 114.15531] },
                { name: 'Bar Leone', address: '中環必列者士街15號', coords: [22.28202, 114.15191] },
                { name: 'ARGO (四季酒店)', address: '中環金融街8號香港四季酒店大堂', coords: [22.28701, 114.15853] },
                { name: 'The Old Man', address: '中環鴨巴甸街37號低座', coords: [22.28251, 114.15423] },
                { name: 'The Orchard', address: '中環機利文新街28-30號', coords: [22.28318, 114.15285] },
                { name: 'The Diplomat', address: '中環砵甸乍街45號 H Code LG樓', coords: [22.28243, 114.15581] },
                { name: 'Tell Camellia', address: '中環砵甸乍街45號 H Code LG樓', coords: [22.28235, 114.15592] },
                { name: 'Penicillin', address: '中環荷李活道23號 Amber Lodge 地下', coords: [22.28264, 114.15481] },
                { name: 'The Dispensary', address: '中環荷李活道10號大館01座', coords: [22.28182, 114.15431] },
                { name: 'Lockdown', address: '中環荷李活道27號地下', coords: [22.28255, 114.15472] },
                { name: '晉逸精品酒店 中環', address: '香港中環威靈頓街122號', coords: [22.28355, 114.15342], isHotel: true }
            ];

            const hotelIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23facc15" width="32px" height="32px"><path d="M0 0h24v24H0z" fill="none"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>`;
            const hotelIcon = L.icon({
                iconUrl: `data:image/svg+xml;charset=UTF-8,${hotelIconSVG}`,
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32],
                className: 'hotel-icon'
            });

            function createPopupContent(item) {
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.name + ', ' + item.address)}`;
                return `
                    <div class="space-y-3">
                        <h3 class="text-lg font-bold text-gray-800">${item.name}</h3>
                        <a href="${mapLink}" target="_blank" class="inline-block mt-2 px-4 py-2 bg-blue-500 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-blue-600 transition-colors duration-200">
                            在 Google Maps 上查看
                        </a>
                    </div>
                `;
            }

            const barListContainer = document.querySelector('#bar-list .space-y-3');
            const markers = {};

            locations.sort((a, b) => a.name.localeCompare(b.name)).forEach(loc => {
                const locId = loc.name.replace(/[^a-zA-Z0-9]/g, '-');
                const markerOptions = loc.isHotel ? { icon: hotelIcon } : {};
                const marker = L.marker(loc.coords, markerOptions).addTo(map)
                    .bindPopup(createPopupContent(loc));

                marker.on('click', function() {
                    const listItem = document.getElementById(`list-item-${locId}`);
                    if (listItem) {
                        document.querySelectorAll('.list-item').forEach(item => {
                            item.classList.remove('bg-yellow-500', 'text-gray-900');
                            item.classList.add('bg-gray-700');
                        });
                        listItem.classList.add('bg-yellow-500', 'text-gray-900');
                        listItem.classList.remove('bg-gray-700');
                        listItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });

                markers[locId] = marker;

                const listItem = document.createElement('div');
                listItem.id = `list-item-${locId}`;
                listItem.className = 'list-item bg-gray-700 p-4 rounded-lg cursor-pointer hover:bg-yellow-500 hover:text-gray-900 transition-colors duration-200 shadow-md';
                listItem.innerHTML = `<h3 class="font-bold text-lg">${loc.name}</h3><p class="text-sm text-gray-400">${loc.address}</p>`;
                
                listItem.addEventListener('click', () => {
                    document.querySelectorAll('.list-item').forEach(item => {
                        item.classList.remove('bg-yellow-500', 'text-gray-900');
                        item.classList.add('bg-gray-700');
                    });
                    listItem.classList.add('bg-yellow-500', 'text-gray-900');
                    listItem.classList.remove('bg-gray-700');
                    
                    map.flyTo(loc.coords, 18);
                    markers[locId].openPopup();
                });
                
                barListContainer.appendChild(listItem);
            });

            const mapContainer = document.getElementById('map-container');
            new ResizeObserver(() => {
                map.invalidateSize();
            }).observe(mapContainer);
        });
    </script>
</body>
</html>
